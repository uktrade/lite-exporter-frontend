{% extends 'layouts/two-pane.html' %}

{% load svg humanize %}

{% block back_link %}
	{% if application.status %}
    	<a href="{% url 'applications:applications' %}" id="back-link" class="govuk-back-link">Back to applications</a>
	{% endif %}
{% endblock %}

{% block full_width %}
	{% if application.status.key == "submitted" %}
		<div class="lite-info-bar lite-info-bar--no-animation">
			Changes made to this application won't impact its processing time.
		</div>
	{% endif %}
	{% if application.status.key == "applicant_editing" %}
		<div class="lite-info-bar lite-info-bar--warning lite-info-bar--no-animation">
			This application won't be processed until it's submitted.
		</div>
	{% endif %}
{% endblock %}

{% block two_thirds %}
	{% if errors %}
		<div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="error-summary">
			<h2 class="govuk-error-summary__title" id="error-summary-title">
				There is a problem
			</h2>
			<div class="govuk-error-summary__body">
				<ul class="govuk-list govuk-error-summary__list">
					{% for key, value in errors.items %}
						<li>
							<a href="#{{ key }}">
								{{ value }}
							</a>
						</li>
					{% endfor %}
				</ul>
			</div>
		</div>
	{% endif %}

	<h1 class="govuk-heading-l govuk-!-margin-bottom-2">
		{% block title %}
			{% if is_editing %}
				Edit the application
			{% else %}
				Apply for a standard export licence
			{% endif %}
		{% endblock %}
	</h1>

	<!-- Details that can't be edited -->
	<p class="govuk-hint govuk-!-margin-bottom-9">
		{% if is_editing %}Licence type: {{ application.application_type.value }} - {% endif %}
		Export type: {{ application.export_type.value }}
	</p>

	{% include "applications/includes/application-initial-task-list.html" %}

	<!-- Tasks -->
	<ol class="lite-task-list">
		<li>
			<h2 class="lite-task-list__section">
				{% if is_editing %}
					More information
				{% else %}
					<span class="lite-task-list__section-number">2. </span> Complete application
				{% endif %}
			</h2>
		    <ul class="lite-task-list__items {% if is_editing %}govuk-!-padding-0{% endif %}">
		        <!-- Goods -->
				{% lcs 'goods.GoodsList.TITLE' as goods_title %}
				{% url 'applications:goods' application.id as goods_url %}
				{% tld goods 'product' 'products' as goods_description %}
				{% include "includes/task-list-item.html" with id='products' title=goods_title url=goods_url status=goods|task_list_item_status description=goods_description %}

				{% include "applications/includes/application-goods-task-list.html" %}
				{% include "applications/includes/application-end-user-task-list.html" %}
				{% include "applications/includes/application-consignee-task-list.html" %}



				<!-- Ultimate end users -->
				{% if ultimate_end_users_required %}
					{% lcs 'applications.UltimateEndUsersPage.TITLE' as ultimate_end_users_title %}
					{% url 'applications:ultimate_end_users' application.id as ultimate_end_users_url %}
					{% tld ultimate_end_users 'ultimate recipient' 'ultimate recipients' as ultimate_end_users_description %}
					{% include "includes/task-list-item.html" with id='ultimate-recipients' title=ultimate_end_users_title url=ultimate_end_users_url status=ultimate_end_users|task_list_item_status description=ultimate_end_users_description %}
				{% endif %}

				<!-- Third parties -->
				<li class="lite-task-list__item">
					<div class="lite-task-list__item-header">
                        <a id="link-third-parties" href="{% url 'applications:third_parties' application.id %}" class="lite-overview-section-header govuk-link govuk-link--no-visited-state">
                        Third parties
                        </a>
				        {% if third_parties %}
				            <div class="lite-tag lite-tag--blue">
								Completed
							</div>
						{% else %}
							<div class="lite-tag lite-tag--hollow">
								Optional
							</div>
						{% endif %}
					</div>
					<div class="lite-task-list__item-details">
						{% if third_parties %}
							<table class="govuk-table">
								<thead class="govuk-table__head">
									<tr class="govuk-table__row">
										<th class="govuk-table__header" scope="col">Name</th>
					                    <th class="govuk-table__header" scope="col">Type</th>
					                    <th class="govuk-table__header" scope="col">Website</th>
										<th class="govuk-table__header" scope="col">Address</th>
										<th class="govuk-table__header" scope="col">Country</th>
										<th class="govuk-table__header" scope="col"></th>
									</tr>
								</thead>
								<tbody class="govuk-table__body">
									{% for third_party in third_parties %}
										<tr class="govuk-table__row">
											<td class="govuk-table__cell">{{ third_party.name }}</td>
					                        <td class="govuk-table__cell">{{ third_party.sub_type.value }}</td>
					                        <td class="govuk-table__cell">{{ third_party.website|default_na }}</td>
											<td class="govuk-table__cell">{{ third_party.address }}</td>
											<td class="govuk-table__cell">{{ third_party.country.name }}</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						{% endif %}
					</div>
				</li>

				<!-- Additional Documents -->
				<li class="lite-task-list__item">
					<div class="lite-task-list__item-header">
						<a id="link-supporting-documentation" href="{% url 'applications:additional_documents' application.id %}" class="lite-overview-section-header govuk-link govuk-link--no-visited-state">
							Supporting documents
						</a>
						{% if additional_documents %}
							<div class="lite-tag lite-tag--blue">
								Completed
							</div>
						{% else %}
							<div class="lite-tag lite-tag--hollow">
								Optional
							</div>
						{% endif %}
					</div>
					<div class="lite-task-list__item-details">
						{% if additional_documents %}
							<table class="govuk-table">
								<thead class="govuk-table__head">
									<tr class="govuk-table__row">
										<th class="govuk-table__header" scope="col">Name</th>
										<th class="govuk-table__header" scope="col"></th>
									</tr>
								</thead>
								<tbody class="govuk-table__body">
									{% for additional_document in additional_documents %}
										<tr class="govuk-table__row">
											<td class="govuk-table__cell">{{ additional_document.name }}</td>
											<td class="govuk-table__cell govuk-table__cell--numeric">
												{% if additional_document.safe == True %}
													<a href="{% url 'applications:download_additional_document' application.id additional_document.id %}" id="document_download" class='govuk-link govuk-link--no-visited-state'>
														Download
													</a>
												{% else %}
													Processing
												{% endif %}
											</td>
											<td class="govuk-table__cell govuk-table__cell--numeric">
												{% if additional_document.safe == True %}
													<a href="{% url 'applications:delete_additional_document' application.id additional_document.id %}" id="document_delete" class='govuk-link govuk-link--no-visited-state lite-link--icon'>
														{% svg 'close' %}
														Delete
													</a>
												{% endif %}
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						{% endif %}
					</div>
				</li>

				<br><br>

				{% if can_submit %}
					<li>
						<div class="app-submit-bar">
							<form method="post">
								{% csrf_token %}
								{% if application.status.key in 'applicant_editing,draft' %}
									<button type="submit" value="submit" class="govuk-button" data-prevent-double-click="true">{% lcs "EDIT_APPLICATION_SUBMIT" %}</button>
								{% else %}
									<a href="{% url 'applications:application' application.id %}" class="govuk-button" draggable="false" role="button">{% lcs "EDIT_APPLICATION_DONE" %}</a>
								{% endif %}
							</form>
							{% if application.status.key == 'draft' %}
								<div class="lite-vertical-align">
									<a id="link-delete-draft" href="{% url 'applications:delete' application.id %}?return_to={{ CURRENT_PATH }}" class="govuk-link lite-link--icon">
										{% svg 'close' %}
										{% lcs 'applications.EditStandardApplicationPage.DRAFT_DELETE_LINK' %}
									</a>
								</div>
							{% endif %}
						</div>
					</li>
				{% endif %}

			</ul>
		</li>
	</ol>
{% endblock %}
