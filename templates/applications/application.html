{% extends 'layouts/base.html' %}

{% load humanize %}

{% block body %}

<h1 class="govuk-heading-l">{{ title }}</h1>

<div class="lite-information-board">
	<div class="govuk-grid-row">
		<div class="govuk-grid-column-one-third">
			<p class="lite-heading-s">Created by</p>
			<p class="govuk-label">John Smith</p>
		</div>
		<div class="govuk-grid-column-one-third">
			<p class="lite-heading-s">Site</p>
			<p class="govuk-label">Site #1</p>
		</div>
		<div class="govuk-grid-column-one-third">
			<p class="lite-heading-s">Last Updated</p>
			<p class="govuk-label">
				<a class="hoverable-link tooltip">
					<span class="tooltip-content" style="min-width: 150px;">
						{{ data.application.last_modified_at|str_date }}
					</span>
					{{ data.application.last_modified_at|str_date }}
				</a>
			</p>
		</div>
	</div>
	<div class="govuk-grid-row">
		<div class="govuk-grid-column-one-third">
			<p class="lite-heading-s">Type</p>
			<p class="govuk-label">SIEL</p>
		</div>
		<div class="govuk-grid-column-one-third">
			<p class="lite-heading-s">Goods</p>
			{% for good in data.application.goods %}
				<p class="govuk-label">
					<a class="hoverable-link tooltip">
						<span class="tooltip-content" style="min-width: 150px;">
							{{ good.description }}
						</span>
						{{ good.name }}
					</a>
				</p>
			{% endfor %}
		</div>
		<div class="govuk-grid-column-one-third">
			<p class="lite-heading-s">
				Destination{{ data.application.destinations|length|pluralize }}
			</p>
			{% for destination in data.application.destinations %}
				<p class="govuk-label">{{ destination.name }}</p>
			{% endfor %}
		</div>
	</div>
</div>

<h3 class="govuk-heading-m">Notes</h3>

<form method="post">
			{% csrf_token %}
			<div class="lite-expandable-textarea lite-case-note-no-transition">
				<textarea id="case_note" name="text" cols="80" class="govuk-textarea" placeholder="Add case note"></textarea>
				<div class="lite-expandable-textarea-controls">
					<a id="case-note-cancel-button" href="{% url 'applications:application' data.application.id %}" class="govuk-button govuk-button--secondary" type="button" draggable="false">
						Cancel
					</a>
					<p id="case_note-warning" class="govuk-hint govuk-character-count__message" aria-live="polite">
						You can enter up to 2200 characters
					</p>
					<button class="govuk-button" type="submit" id="button-post-note">
						Post note
					</button>
				</div>
			</div>
		</form>
		<div class="lite-case-notes">
			{% for item in activity %}
				{% if item.type == 'case_note' %}
					<div class="lite-activity-item">
						<p class="govuk-body" style="margin-bottom: 0;">
							<span class="user">{{ item.user.first_name }} {{ item.user.last_name }}</span>{% get_string 'activity.added_a_case_note' %}
						</p>
						<div class="lite-case-note">
							{{ item.data }}
						</div>
						<p class="govuk-hint govuk-!-font-size-16" style="margin-top: 10px;">{{ item.date|str_date }}</p>
					</div>
				{% elif item.type == 'change' %}
					<div class="lite-activity-item">
						<p class="govuk-body" style="margin-bottom: 0;">
							{% for key, value in item.data.items %}
								{% if forloop.first %}<span class="user">{{ item.user.first_name }} {{ item.user.last_name }}</span> set{% endif %} the <span class="highlight">{{ key }}</span> to <span class="highlight">{{ value|sentence_case|lower }}</span>{% if not forloop.last %}{% ifequal forloop.revcounter 2 %} and {% else %}, {% endifequal %}{% else %}.{% endif %}
							{% endfor %}
						</p>
						<p class="govuk-hint govuk-!-font-size-16" style="margin-top: 10px;">{{ item.date|str_date }}</p>
					</div>
				{% endif %}
			{% endfor %}
		</div>

{% for note in data.application.case_notes %}
    <p>{{ note.text }}</p>
    <hr>
{% endfor %}

{#<div class="lite-tabs--fade">#}
{#	<div class="lite-tabs">#}
{#		<a class="lite-tabs__tab selected">Status Tracker</a>#}
{#		<a class="lite-tabs__tab">Requests for Information</a>#}
{#		<a class="lite-tabs__tab">Messages</a>#}
{#		<a class="lite-tabs__tab">Ammend/Withdraw</a>#}
{#		<a class="lite-tabs__tab">Outcome Documents</a>#}
{#	</div>#}
{#</div>#}
{#{{ data }}#}
{#<div class="section-container no-borders">#}
{#	<div class="section">#}
{#		<div class="section-header">#}
{#			<p class="govuk-heading-s">Draft</p>#}
{#			<span class="govuk-caption-m">Created on {{ data.application.created_at|str_date }}</span>#}
{#		</div>#}
{#		<p class="info-label info-label--blue">Completed</p>#}
{#	</div>#}
{#	<div class="section">#}
{#		<div class="section-header">#}
{#			<p class="govuk-heading-s">Submitted</p>#}
{#			<span class="govuk-caption-m">Submitted on {{ data.application.submitted_at|str_date }}</span>#}
{#		</div>#}
{#		<p class="info-label info-label--blue">Completed</p>#}
{#	</div>#}
{#	<div class="section">#}
{#		<div class="section-header">#}
{#			<p class="govuk-heading-s">Initial Checks</p>#}
{#			<span class="govuk-caption-m">Checking your organisation details</span>#}
{#		</div>#}
{#		<p class="info-label info-label--orange">In Progress</p>#}
{#	</div>#}
{#	<div class="section">#}
{#		<div class="section-header">#}
{#			<p class="govuk-heading-s">Technical Assessment</p>#}
{#			<span class="govuk-caption-m">Classification code validation</span>#}
{#		</div>#}
{#		<p class="info-label">Not started</p>#}
{#	</div>#}
{#	<div class="section">#}
{#		<div class="section-header">#}
{#			<p class="govuk-heading-s">Licensing Unit Processing</p>#}
{#			<span class="govuk-caption-m">Checking application form details and other documentation</span>#}
{#		</div>#}
{#		<p class="info-label">Not started</p>#}
{#	</div>#}
{#	<div class="section">#}
{#		<div class="section-header">#}
{#			<p class="govuk-heading-s">With OGD Advisers</p>#}
{#			<span class="govuk-caption-m">Additional advice from other government departments</span>#}
{#		</div>#}
{#		<p class="info-label">Not started</p>#}
{#	</div>#}
{#	<div class="section">#}
{#		<div class="section-header">#}
{#			<p class="govuk-heading-s">Final Assessment</p>#}
{#			<span class="govuk-caption-m">Undergoing final checks</span>#}
{#		</div>#}
{#		<p class="info-label">Not started</p>#}
{#	</div>#}
{#	<div class="section">#}
{#		<div class="section-header">#}
{#			<p class="govuk-heading-s">Decision Reached</p>#}
{#		</div>#}
{#		<p class="info-label">Not started</p>#}
{#	</div>#}
{#</div>#}

{% endblock %}
