{% load static %}

{% url 'applications:application' application.id 'case-notes' as post_url %}

{% if post_url %}

	<form method="post" action="{{ post_url }}">
		{% csrf_token %}
        {% if not status_is_terminal %}
		    <div class="lite-expandable-textarea lite-case-note-no-transition">
			    <textarea id="case_note" name="text" cols="80" class="govuk-textarea" placeholder="Add note to application"></textarea>
			    <div class="lite-expandable-textarea-controls">
				    <p id="case_note-warning" class="govuk-hint govuk-character-count__message" aria-live="polite" style="text-align: left; margin: 2px 0 0 0;">
					    {% get_string 'case_notes.max_length' %}
				    </p>
				    <a id="case-note-cancel-button" href="{% url 'applications:application' application.id 'case-notes' %}" class="govuk-button govuk-button--secondary govuk-button--secondary-white" type="button" draggable="false">
					    {% lcs 'CANCEL' %}
				    </a>
				    <button class="govuk-button" type="submit" id="button-post-note">
					    {% lcs 'POST_NOTE' %}
				    </button>
			    </div>
		    </div>
        {% endif %}
	</form>

{% endif %}

{% if notes %}
	<br><br>

	<div class="lite-case-notes">
		{% for item in notes %}
			<p class="govuk-body" style="margin-bottom: 0;">
				{% if item.user.team %}<span style="font-weight: 600;">{{item.user.team.name}}</span>{% else %}<a href="{% url 'users:user' item.user.id %}" class="govuk-link govuk-link--no-visited-state govuk-!-font-weight-bold">{{ item.user.first_name }} {{ item.user.last_name }}</a>
				{% endif %} added a note:
			</p>
			<div class="lite-application-note lite-application-note{% if item.user.team %}--internal{% else %}--exporter{% endif %}">
				{{ item.text }}
			</div>
			<p class="govuk-hint govuk-!-font-size-16" style="margin-top: 10px;">{{ item.created_at|str_date }}</p>
			<br><br>
		{% endfor %}
	</div>
{% else %}
    <div class="lite-information-text">
        <span class="lite-information-text__icon" aria-hidden="true">!</span>
        <p class="lite-information-text__text">
            <span class="govuk-visually-hidden">Information</span>
            There are no notes on this application.
        </p>
    </div>
{% endif %}

<script src="{% static 'javascripts/pluralize.js' %}"></script>
<script src="{% static 'javascripts/specific/case_notes.js' %}"></script>
