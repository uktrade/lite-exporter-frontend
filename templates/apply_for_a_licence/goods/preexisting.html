{% extends 'layouts/full_width.html' %}

{% block back_link %}
	<a href="{% url 'apply_for_a_licence:goods' draft_id %}" class="govuk-back-link lite-persistent-bar--back">Back to Goods</a>
{% endblock%}

{% block body %}

<h2 class="govuk-heading-l">{{ title }}</h2>

{% if description or part_number or control_code or data %}
	<div class="govuk-grid-row">
		<div class="govuk-grid-column-one-third lite-filters">
			<div class="lite-filter-box">
				<form method="get">
					<h4 class="govuk-heading-s">Filter</h4>
					<div class="govuk-form-group">
						<label class="govuk-label" for="description">
							Description
						</label>
						<input class="govuk-input" id="description" name="description" type="text" autocomplete="off" autocorrect="off"  value="{{ description }}">
					</div>
					<div class="govuk-form-group">
						<label class="govuk-label" for="part_number">
							Part Number
						</label>
						<input class="govuk-input" id="part_number" name="part_number" type="text" autocomplete="off" autocorrect="off"  value="{{ part_number }}">
					</div>
                    <div class="govuk-form-group">
						<label class="govuk-label" for="control_rating">
							Control Rating
						</label>
						<input class="govuk-input" id="control_rating" name="control_rating" type="text" autocomplete="off" autocorrect="off"  value="{{ control_code }}">
					</div>
					<button type="submit" class="govuk-button" style="margin-bottom: 4px; width: 100%;">Filter</button>
				</form>
			</div>
		</div>

		<div class="govuk-grid-column-two-thirds">
			{% if description or part_number or control_code %}
				<div class="lite-filter-bar">
					<p>Showing goods where</p>
					{% if description %}
						<p>description contains</p>
						<a href="{% url 'apply_for_a_licence:preexisting_good' draft_id %}?part_number={{ part_number }}&control_rating={{ control_code }}" class="govuk-button govuk-button--secondary lite-filter-bar-item">
							<div class="lite-filter-bar-item-remove">
								✕
							</div>
							{{ description }}
						</a>
					{% endif %}
					{% if description and part_number and not control_code %}
						<p>and</p>
					{% elif part_number and control_code%}
                        <p>,</p>
                    {% endif %}
					{% if part_number %}
						<p>part number contains</p>
						<a href="{% url 'apply_for_a_licence:preexisting_good' draft_id %}?description={{ description }}&control_rating={{ control_code }}" class="govuk-button govuk-button--secondary lite-filter-bar-item">
							<div class="lite-filter-bar-item-remove">
								✕
							</div>
							{{ part_number }}
						</a>
					{% endif %}
                    {% if description or part_number and control_code %}
                        <p>and</p>
                    {% endif %}
                    {% if control_code %}
						<p>control rating contains</p>
						<a href="{% url 'apply_for_a_licence:preexisting_good' draft_id %}?description={{ description }}&part_number={{ part_number }}" class="govuk-button govuk-button--secondary lite-filter-bar-item">
							<div class="lite-filter-bar-item-remove">
								✕
							</div>
							{{ control_code }}
						</a>
					{% endif %}
				</div>
			{% endif %}
			{% if data %}
				{% for good in data %}
					<div class="lite-card">
						<h4 class="govuk-heading-s" style="margin-bottom: 0;">{{ good.description|highlight_text:description }}</h4>
						<span class="govuk-caption-m" style="display: inline-block; margin-right: 10px;">Part Number: </span><p class="govuk-label" style="display: inline-block; {% if not good.part_number %}opacity: 0.4;{% endif %}">{{ good.part_number|highlight_text:part_number|default:"N/A" }}</p>
						<span style="display: block;">   </span>
						<span class="govuk-caption-m" style="display: inline-block; margin-right: 10px;">Control Rating: </span><p class="govuk-label" style="display: inline-block; {% if not good.control_code %}opacity: 0.4;{% endif %}">{{ good.control_code|highlight_text:control_code|default:"N/A" }}</p>
						<div style="display: flex; justify-content: flex-end;">
							<a href="{% url 'apply_for_a_licence:add_preexisting_good' draft_id good.id %}" class="govuk-button" role="button" draggable="false" style="margin-bottom: 0;">Add to application</a>
						</div>
					</div>
				{% endfor %}
			{% else %}
				<p class="govuk-caption-l">Nothing matched your search criteria.</p>
			{% endif %}
		</div>
	</div>
{% else %}
	<p class="govuk-caption-l">Your organisation doesn't have any goods which are available to be used on an application.</p>
    <br>
    <a href="{% url 'goods:add' %}" class="govuk-link">Add a good to my organisation</a>
{% endif %}

{% endblock %}
