{% extends 'layouts/two_pane.html' %}

{% load humanize custom_tags %}

{% block back-button %}{% endblock %}

{% block twoThirds %}

<style media="screen">
	.govuk-table__row {
		line-height: 35px;
	}
	.govuk-table__head, .govuk-table__body {
		border-top: 1px solid rgb(230, 230, 230);
	}
	.govuk-table__header, .govuk-table__cell {
		border-bottom: 1px solid rgb(230, 230, 230);
	}
	.govuk-table * {
		vertical-align: top;
	}
	.lite-section {
		border-top: 1px solid rgb(230, 230, 230);
		border-bottom: 1px solid rgb(230, 230, 230);
		border: none;
		padding: 25px;
		background-color: rgb(250, 250, 250);
		border: 1px solid rgb(245, 245, 245);
		box-sizing: border-box;
	}
	</style>

{% if errors %}
	<div class="govuk-error-summary" aria-labelledby="error-summary-title" role="alert" tabindex="-1" data-module="error-summary">
		<h2 class="govuk-error-summary__title" id="error-summary-title">
			There are errors on this page
		</h2>
		<div class="govuk-error-summary__body">
			<ul class="govuk-list govuk-error-summary__list">
				{% for key, value in errors.items %}
					<li>
						<a href="#{{ key }}">
							{{ value }}
						</a>
					</li>
				{% endfor %}
			</ul>
		</div>
	</div>
{% endif %}

<span class="govuk-caption-l">
	{{ draft.name }}
</span>
<h2 class="govuk-heading-l">
	Overview
</h2>

<div class="govuk-form-group">
	<p class="govuk-caption-m">The following sections can be completed in any order.</p>
</div>

<div class="lite-section">
	<table class="govuk-table">
		<tbody class="govuk-table__body">
			<tr class="govuk-table__row">
				<th class="govuk-table__header" scope="row">Name</th>
				<td class="govuk-table__cell">{{ draft.name }}</td>
				<!--<td class="govuk-table__cell"><a href="#" class="govuk-link">Edit</a></td>-->
			</tr>
			<tr class="govuk-table__row">
				<th class="govuk-table__header" scope="row">Licence Type</th>
				<td class="govuk-table__cell">{{ draft.licence_type }}</td>
			</tr>
			<tr class="govuk-table__row">
				<th class="govuk-table__header" scope="row">Export Type</th>
				<td class="govuk-table__cell">{{ draft.export_type }}</td>
			</tr>
			{% if draft.reference_number_on_information_form %}
			<tr class="govuk-table__row">
				<th class="govuk-table__header" scope="row">Reference Number</th>
				<td class="govuk-table__cell">{{ draft.reference_number_on_information_form }}</td>
			</tr>
			{% endif %}
			<tr class="govuk-table__row">
				<th class="govuk-table__header" scope="row">Created at</th>
				<td class="govuk-table__cell">{{ draft.created_at|str_date }}</td>
			</tr>
		</tbody>
	</table>
</div>

<div class="lite-section {% if errors|key_value:'goods' %}govuk-form-group--error{% endif %}">
	<div class="lite-section-header">
		<div>
			<a id="goods" href="{% url 'apply_for_a_licence:goods' draft.id %}" class="lite-overview-section-header govuk-link govuk-link--no-visited-state">
				Goods
			</a>
		</div>
		{% if goods|length %}
			<div class="lite-info-label lite-info-label--blue">
				Done
			</div>
		{% else %}
			<div class="lite-info-label">
				Not Started
			</div>
		{% endif %}
	</div>
	{% if errors|key_value:'goods' %}
		<p class="govuk-error-message">
			{{ errors|key_value:'goods' }}
		</p>
	{% endif %}
	<p class="govuk-caption-m">Add goods to your application</p>
</div>

<div class="lite-section {% if errors|key_value:'sites' %}govuk-form-group--error{% endif %}">
	<div class="lite-section-header">
		<div>
			<a id="location" href="{% url 'apply_for_a_licence:location' draft.id %}" class="lite-overview-section-header govuk-link govuk-link--no-visited-state">
				Location of goods
			</a>
		</div>
		{% if sites or external_locations %}
			<div class="lite-info-label lite-info-label--blue">
				Done
			</div>
		{% else %}
			<div class="lite-info-label">
				Not Started
			</div>
		{% endif %}
	</div>
	{% if errors|key_value:'location' %}
		<p class="govuk-error-message">
			{{ errors|key_value:'location' }}
		</p>
	{% endif %}

	{% if sites %}
		<table class="govuk-table">
			<tbody class="govuk-table__body">
				<tr class="govuk-table__row">
					<th class="govuk-table__header" scope="row">Site</th>
					<td class="govuk-table__header">Location</td>
				</tr>
				{% for site in sites %}
					<tr class="govuk-table__row">
						<td class="govuk-table__cell" scope="row">{{ site.name }}</td>
						<td class="govuk-table__cell">
							{{ site.address.address_line_1 }}<br/>
							{% if site.address.address_line_2 %}
								{{ site.address.address_line_2 }}<br/>
							{% endif %}
							{{ site.address.city }}<br/>
							{{ site.address.postcode }}<br/>
							{{ site.address.country }}
						</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	{% elif external_locations %}
		<table class="govuk-table">
			<tbody class="govuk-table__body">
				<tr class="govuk-table__row">
					<th class="govuk-table__header" scope="row">Name</th>
					<td class="govuk-table__header">Location</td>
				</tr>
				{% for external_location in external_locations %}
					<tr class="govuk-table__row">
						<td class="govuk-table__cell" scope="row">{{ external_location.name }}</td>
						<td class="govuk-table__cell">{{ external_location.address|linebreaksbr }}<br>{{ external_location.country }}</td>
					</tr>
				{% endfor %}
			</tbody>
		</table>
	{% else %}
		<p class="govuk-caption-m">Set where your goods are located</p>
	{% endif %}
</div>

<div class="lite-section {% if errors|key_value:'end_user' %}govuk-form-group--error{% endif %}">
	<div class="lite-section-header">
		<div>
			<a id="end_users" href="{% url 'apply_for_a_licence:end_user' draft.id %}" class="lite-overview-section-header govuk-link govuk-link--no-visited-state">
				End User
			</a>
		</div>

		{% if draft.end_user %}
			<div class="lite-info-label lite-info-label--blue">
				Done
			</div>
		{% else %}
			<div class="lite-info-label">
				Not Started
			</div>
		{% endif %}
	</div>
	{% if errors|key_value:'end_user' %}
		<p class="govuk-error-message">
			{{ errors|key_value:'end_user' }}
		</p>
	{% endif %}
	{% if draft.end_user %}
		<table class="govuk-table">
			<tbody class="govuk-table__body">
				<tr class="govuk-table__row">
					<th class="govuk-table__header" scope="row">Type</th>
					<td class="govuk-table__cell">{{ draft.end_user.type }}</td>
				</tr>
				<tr class="govuk-table__row">
					<th class="govuk-table__header" scope="row">Name</th>
					<td class="govuk-table__cell">{{ draft.end_user.name }}</td>
				</tr>
				{% if draft.end_user.website %}
				<tr class="govuk-table__row">
					<th class="govuk-table__header" scope="row">Website</th>
					<td class="govuk-table__cell">{{ draft.end_user.website }}</td>
				</tr>
				{% endif %}
				<tr class="govuk-table__row">
					<th class="govuk-table__header" scope="row">Address</th>
					<td class="govuk-table__cell">{{ draft.end_user.address }}<br/>{{ draft.end_user.country }}</td>
				</tr>
			</tbody>
		</table>
	{% else %}
		<p class="govuk-caption-m">Add an end user to your application</p>
	{% endif %}
</div>

<div class="lite-submit-bar js-is-sticky">
<a href="{% url 'apply_for_a_licence:delete' draft.id %}" class="cancel-link" style="float: right;">
	Delete Application
</a>
<form method="post">
	{% csrf_token %}
	<button type="submit" class="govuk-button" name="button" data-prevent-double-click="true">Submit Application</button>
</form>
</div>

{% load static %}
<script src="{% static 'javascripts/modal.js' %}"></script>
<script src="{% static 'javascripts/specific/overview.js' %}"></script>
<script src="{% static 'javascripts/stickybits.min.js' %}"></script>

<script type="text/javascript">
	stickybits('.lite-submit-bar', {useStickyClasses: true, verticalPosition: 'bottom'});
</script>

{% endblock %}
{% block oneTahird %}
<aside role="complementary">
	<h2 class="govuk-heading-m" id="subsection-title">
		Need to go?
	</h2>
	<p class="govuk-body">
		You can find this application in your <a class="govuk-link" href="/drafts/">drafts</a>.
	</p>
</aside>
<br>
<br>
<aside role="complementary">
	<h2 class="govuk-heading-m" id="subsection-title">
		Don't want to continue this application?
	</h2>
	<a href="{% url 'apply_for_a_licence:delete' draft.id %}" class="govuk-body govuk-link">
		Delete Draft Application
	</a>
</aside>
{% endblock %}
