{% extends 'layouts/base.html' %}

{% load svg humanize %}
{% load static %}

{% block back_link %}
	{% include 'includes/breadcrumbs.html' %}
{% endblock %}

{% block body %}

	<div class="lite-app-bar">
		<div class="lite-app-bar__content">
			<h2 class="govuk-heading-l">
				{% block title %}
					Goods
				{% endblock %}
			</h2>
			<p class="govuk-caption-m">
				{% if goods.count == 0 and not filtered %}
					Your organisation doesn't have any goods.
                {% elif goods.count == 0 and filtered %}
                    There are no goods based on filter
				{% endif %}
			</p>
		</div>
		<div class="lite-app-bar__controls">
			<a href="{% url 'goods:add' %}" id="add-a-good" class="govuk-button" draggable="false" role="button">
				Add a good
			</a>
		</div>
	</div>

	{% if goods|length or filtered %}
        <div class="lite-js-only">
            <a href="#" id="show-filters-link" class="govuk-link govuk-link--no-visited-state lite-filter-toggle-link">
                {% svg 'plus' %}
                Show filters
            </a>
            <a href="#" id="hide-filters-link" class="govuk-link govuk-link--no-visited-state lite-filter-toggle-link">
                {% svg 'minus' %}
                Hide filters
            </a>
        </div>
        <form id="filters" action="{% url 'goods:goods'%}" method="get">

            <div class="govuk-grid-row lite-filter-bar">
			<div method="get">
				<div class="govuk-grid-column-one-quarter">
					<label class="govuk-label" for="description">
						Description
					</label>
					<input class="govuk-input" id="description" name="description" type="text" autocomplete="off" autocorrect="off"  value="{{ description }}">
				</div>
                <div class="govuk-grid-column-one-quarter">
					<label class="govuk-label" for="control_rating">
						Control list classification
					</label>
					<input class="govuk-input" id="control_rating" name="control_rating" type="text" autocomplete="off" autocorrect="off"  value="{{ control_code }}">
				</div>
				<div class="govuk-grid-column-one-quarter">
					<label class="govuk-label" for="part_number">
						Part number
					</label>
					<input class="govuk-input" id="part_number" name="part_number" type="text" autocomplete="off" autocorrect="off"  value="{{ part_number }}">
				</div>
				<div class="govuk-grid-column-one-quarter">
                     <label class="govuk-label" for="filter" style="visibility: collapse;">
                        --
                    </label>
                    <div class="lite-buttons-row">
                        <button type="submit" form="filters" class="govuk-button" style="margin: 0;" id="button-apply-filters">
                            Apply filters
                        </button>
                    </div>
				</div>
            </div>
            </div>
        </form>
        {% if goods.count %}
            <table class="govuk-table">
                <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th class="govuk-table__header" scope="col">Description</th>
                        <th class="govuk-table__header" scope="col" style="min-width: 150px">Control list entry</th>
                        <th class="govuk-table__header" scope="col">Part number</th>
                        <th class="govuk-table__header" scope="col">Status</th>
                    </tr>
                </thead>
                <tbody class="govuk-table__body">
                    {% for good in goods.results %}
                        <tr class="govuk-table__row">
                            <td class="govuk-table__cell">
                                <a class="govuk-link govuk-link--no-visited-state app-icon-label" href="{% url 'goods:good' pk=good.id %}" id="good-description">
                                    <p>{{ good.description }}</p>
                                    {% if good.status.key == 'verified' %}<span class="app-verified__symbol">{% svg 'verified' %}</span>{% endif %}
                                    {% if good.query_id and good.query_id in notifications %}
                                        <span class="lite-notification-bubble">{{ notifications|key_value:good.query_id }} <span class="govuk-visually-hidden"> {% lcs "NOTIFICATIONS" %}</span></span>
                                    {% endif %}
                                </a>
                            </td>
                            <td class="govuk-table__cell" style="{% if not good.control_code %}opacity: 0.4;{% endif %}" id="good-control_code">{{ good.control_code|default:"N/A" }}</td>
                            <td class="govuk-table__cell" style="{% if not good.part_number %}opacity: 0.4;{% endif %}" id="good-part-number">{{ good.part_number|default:"N/A" }}</td>
                            <td class="govuk-table__cell">{{ good.status.value }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% include "includes/pagination.html" with data=goods %}
        {% endif %}
	{% endif %}

{% endblock %}

{% block javascript %}
	<script src="{% static 'javascripts/filter-bar.js' %}"></script>
{% endblock %}
