{% extends 'layouts/base.html' %}

{% load humanize static %}

{% block back_link %}
	<a href="/goods/" class="govuk-back-link">Back to Goods</a>
{% endblock %}

{% block body %}

    <div class="lite-app-bar">
		<div class="lite-app-bar__content">
			<h2 class="govuk-heading-l">{{ title }}</h2>
		</div>
		<div class="lite-app-bar__controls">
			<span class="lite-tag lite-tag--blue">
				{{ good.status }}
			</span>
		</div>
    </div>

	<!-- Notify the user if their good has a special status -->
	{% if good.status != 'submitted' %}
		<div class="govuk-inset-text" style="margin-top: -5px;">
			{% if good.status == 'final' %}
				This good has been certified by ECJU and can no longer be edited.
			{% elif good.status == 'clc_query' %}
				Bananas
			{% elif good.status == 'draft' %}
				This good is a draft, which means you can still edit it.
			{% endif %}
		</div>
	{% endif %}

	<!-- Summary -->
	<div class="govuk-grid-row">
		<div class="govuk-grid-column-two-thirds">
			<dl class="govuk-summary-list">
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						Description
					</dt>
					<dd class="govuk-summary-list__value">
						{{ good.description }}
					</dd>
				</div>
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						Is the good controlled?
					</dt>
					<dd class="govuk-summary-list__value">
						{{ good.is_good_controlled }}
					</dd>
				</div>
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						Control Code Classification
					</dt>
					<dd class="govuk-summary-list__value">
						{{ good.control_code }}
					</dd>
				</div>
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						Part Number
					</dt>
					<dd class="govuk-summary-list__value">
						{{ good.part_number }}
					</dd>
				</div>
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						Is the good intended to be incorporated into an end product?
					</dt>
					<dd class="govuk-summary-list__value">
						{{ good.is_good_end_product }}
					</dd>
				</div>
			</dl>
		</div>
	</div>

	<!-- Documents -->
    {% if data.good.status != 'submitted' %}
        <div class="lite-app-bar--right">
            <a role="button" draggable="false" class="govuk-button" href="{% url 'goods:attach_documents' good.id %}">
                {% get_string 'goods.documents.attach_documents.button' %}
            </a>
        </div>
    {% endif %}

    {% if documents %}
        <p class="govuk-caption-m">{% get_string 'goods.documents.description' %}</p>

        {% for document in documents %}
            <div class="lite-card lite-card--download">
                <div>
                    <p class="govuk-body govuk-!-font-weight-bold" style="margin-bottom: 10px;">{{ document.name }}</p>
                    <p class="govuk-body" style="margin-bottom: 10px">{{ document.description|slice:"0:40" }} {% if document.description|length > 40 %}...{% endif %}</p>
                    <p class="govuk-caption-m" style="margin: 0;">Uploaded by {{ document.user.first_name }} {{ document.user.last_name }} at {{ document.created_at|str_date }}</p>
                </div>
                <div class="lite-vertical-align">
                    {% if document.safe == True %}
                        <a class="govuk-link lite-link--icon govuk-link--no-visited-state" href="{% url 'goods:document' pk=data.good.id file_pk=document.id %}">
                            <span class="govuk-visually-hidden">{% get_string 'goods.documents.download_document' %}</span>
                            Download
                        </a>
                        {% if data.good.status != 'submitted' %}
                            <a href="{% url 'goods:delete_document' data.good.id document.id %}" style="margin: 0; margin-left: 20px;" class="govuk-link">
                                Delete
                            </a>
                        {% endif %}
                    {% elif document.safe == False %}
                        <p class="govuk-label" style="margin: 0;color:red;">{% get_string 'goods.documents.virus_infected' %}</p>
                    {% else %}
                        <p class="govuk-label" style="margin: 0;">{% get_string 'goods.documents.processing' %}</p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p class="govuk-caption-l">{% get_string 'goods.documents.good_has_no_documents' %}</p>
    {% endif %}

	{{ good }}

    {% if good.clc_query_id %}
        <div class="lite-tabs--fade">
            <a href="{% url 'goods:good-detail' data.good.id 'case-notes' %}" class="lite-tabs__tab {% if type == 'case-notes' %}selected{% endif %}" id="case-notes-tab">
			    Notes
                {% if case_note_notifications %}
                    <div class="lite-notification-bubble">
                        {{ case_note_notifications }}
                    </div>
                {% endif %}
		    </a>
            <a href="{% url 'goods:good-detail' data.good.id 'ecju-queries' %}" class="lite-tabs__tab {% if type == 'ecju-queries' %}selected{% endif %}" id="ecju-queries-tab">
                ECJU Queries
                {% if ecju_query_notifications %}
                    <div class="lite-notification-bubble">
                        {{ ecju_query_notifications }}
                    </div>
			    {% endif %}
            </a>
        </div>
        {% if type == 'case-notes' %}
	        {% include "goods/tabs/case-notes.html" %}
        {% elif type == 'ecju-queries'%}
	        {% include "goods/tabs/ecju-queries.html" %}
        {% endif %}
    {% endif %}

{% endblock %}
