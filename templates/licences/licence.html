{% extends 'layouts/base.html' %}

{% block body %}
	<div class="lite-app-bar">
		<div class="lite-app-bar__content">
			<h1 class="govuk-heading-l">
				{% block title %}
					{% if licence.application.case_type.sub_type.key == "standard" or licence.application.case_type.sub_type.key == "open" %}
						Licence {{ licence.application.reference_code }}
					{% else %}
						Clearance {{ licence.application.reference_code }}
					{% endif %}
				{% endblock %}
			</h1>
			<h2 class="govuk-heading-m">{{ licence.application.case_type.sub_type.value }}</h2>
		</div>
	</div>

	<div class="govuk-grid-row">
		<dl class="govuk-summary-list govuk-summary-list--no-border govuk-grid-column-two-thirds">
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
					Your reference
				</dt>
				<dd class="govuk-summary-list__value">
					<a href="{% url 'applications:application' licence.application.id %}?return_to={{ request.path }}" class="govuk-link govuk-link--no-visited-state">{{ licence.application.name }}</a>
				</dd>
			</div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
					Licence
				</dt>
				<dd class="govuk-summary-list__value">
					{% for document in licence.application.documents %}
						<span class="govuk-visually-hidden">{% lcs "licences.LicencesList.DOWNLOAD_HIDDEN_TEXT" %}</span>
						<a href="{% url 'applications:download_generated_document' document.id licence.application.id %}" class="govuk-link govuk-link--no-visited-state" id="document-download">{{ document.advice_type.value }}.pdf</a>
					{% endfor %}
				</dd>
			</div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
					Status
				</dt>
				<dd class="govuk-summary-list__value">
					{{ licence.application.status.value }}
				</dd>
			</div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
					Start date
				</dt>
				<dd class="govuk-summary-list__value">
					{{ licence.start_date|str_date_only }}
				</dd>
			</div>
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
					End date
				</dt>
				<dd class="govuk-summary-list__value">
					{{ licence.start_date|add_months:licence.duration }}
				</dd>
			</div>
			{% if licence.application.destinations %}
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						Destination
					</dt>
					<dd class="govuk-summary-list__value">
						{% for destination in licence.application.destinations %}
							{{ destination.country.name }}{% if not forloop.last %},{% endif %}
						{% endfor %}
					</dd>
				</div>
			{% endif %}
			{% if licence.application.end_user %}
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						End User
					</dt>
					<dd class="govuk-summary-list__value">
						{{ licence.application.end_user.party.name }}<br>
						{{ licence.application.end_user.party.address }}<br>
						{{ licence.application.end_user.party.country.name }}<br>
						<a href="{% url 'applications:end_user_download_document' licence.application.id licence.application.end_user.party.id %}" class="govuk-link govuk-link--no-visited-state">{{ licence.application.end_user.party.document.name }}</a>
					</dd>
				</div>
			{% endif %}
			{% if licence.application.ultimate_end_users %}
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						Ultimate End Users
					</dt>
					<dd class="govuk-summary-list__value">
						{% for user in licence.application.ultimate_end_users %}
							{{ user.party.name }}<br>
							{{ user.party.address }}<br>
							{{ user.party.country.name }}<br>
							<a href="{% url 'applications:ultimate_end_user_download_document' licence.application.id user.party.id %}" class="govuk-link govuk-link--no-visited-state">{{ user.party.document.name }}</a>
						{% endfor %}
					</dd>
				</div>
			{% endif %}
			{% if licence.application.consignee %}
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						Consignee
					</dt>
					<dd class="govuk-summary-list__value">
						{{ licence.application.consignee.party.name }}<br>
						{{ licence.application.consignee.party.address }}<br>
						{{ licence.application.consignee.party.country.name }}<br>
						<a href="{% url 'applications:consignee_download_document' licence.application.id licence.application.consignee.party.id %}" class="govuk-link govuk-link--no-visited-state">{{ licence.application.consignee.party.document.name }}</a>
					</dd>
				</div>
			{% endif %}
			{% if licence.application.third_parties %}
				<div class="govuk-summary-list__row">
					<dt class="govuk-summary-list__key">
						Third Parties
					</dt>
					<dd class="govuk-summary-list__value">
						{% for user in licence.application.third_parties %}
							{{ user.party.role.value }}<br>
							{{ user.party.name }}<br>
							{{ user.party.address }}<br>
							{{ user.party.country.name }}<br>
							<a href="{% url 'applications:third_party_download_document' licence.application.id user.party.id %}" class="govuk-link govuk-link--no-visited-state">{{ user.party.document.name }}</a><br>
						{% endfor %}
					</dd>
				</div>
			{% endif %}
			<div class="govuk-summary-list__row">
				<dt class="govuk-summary-list__key">
					Supporting Documents
				</dt>
				<dd class="govuk-summary-list__value">
					{% for document in licence.application.documents %}
						<a href="{% url 'applications:download_generated_document' document.id licence.application.id %}" class="govuk-link govuk-link--no-visited-state" id="generated-document-download">{{ document.name }}</a><br>
					{% endfor %}
				</dd>
			</div>
		</dl>
	</div>

	<table class="govuk-table">
		<thead class="govuk-table__head">
			<tr class="govuk-table__row">
				<th class="govuk-table__header" scope="col">Products</th>
				{% if licence.application.goods.0.quantity %}
					<th class="govuk-table__header" scope="col">Applied for quantity</th>
					<th class="govuk-table__header" scope="col">Licensed quantity</th>
				{% endif %}
				{% if licence.application.goods.0.usage %}
					<th class="govuk-table__header" scope="col">Usage</th>
				{% endif %}
			</tr>
		</thead>
		<tbody class="govuk-table__body">
			{% for good in licence.application.goods %}
					<tr class="govuk-table__row">
						<td class="govuk-table__cell">
							{% if good.good %}
								{{ good.good.control_code }}<br>
								{{ good.good.description }}
							{% else %}
								{{ good.control_code }}<br>
								{{ good.description }}
							{% endif %}
						</td>
						{% if licence.application.goods.0.quantity %}
							<td class="govuk-table__cell">
								{{ good.quantity }}
							</td>
							<td class="govuk-table__cell">
								{{ good.licenced_quantity }} (£{{ good.licenced_value }})
							</td>
						{% endif %}
						{% if licence.application.goods.0.usage %}
							<td class="govuk-table__cell">
								{{ good.usage }} {% if licence.application.goods.0.quantity %}(£{{ good|get_usage_value }}){% endif %}
							</td>
						{% endif %}
					</tr>
			{% endfor %}
		</tbody>
	</table>
{% endblock %}
